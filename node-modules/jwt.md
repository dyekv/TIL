# jwtとは

json-web-tokenの略

認証の機能を実装するライブラリ

ヘッダにトークンを添付してやり取りすることで認証処理が実現できる

# 簡単な認証の流れ（例）

- クライアントから、ID・パスワードを送信してログイン処理

- サーバ側で鍵を使い暗号化してDBのID・パスワードと照合（DB内では暗号化して保存してあるため）

- DBの情報と一致したらトークンを生成してクライアントに返却

- クライアント側でブラウザのデータベース内に保存する（localForgeを使用)

- クライアントからFetchなどの処理を行う際はヘッダに保存したトークン情報を添付してリクエスト

- リクエストのたびにサーバ側で都度トークンを生成し、照合できたらリクエストを受け付ける

- トークンには有効期限を設けることができるため、有効期限が切れたら再発行もしくは再ログインさせる

### Nextype環境

nextype環境では毎回fetchのたびにヘッダにトークンを添付する処理が面倒くさいため

jwt-fetchというミドルウェアを作成して、実装している

#### `lib/webdb`

ブラウザのDBにアクセスするコンストラクタを作っている

#### `lib/jwtFetch`

クライアントで動作し、Fetch処理のヘッダにトークンを添付する

#### `controller/Auth.ts`

ログインの処理及び、確認を行う

#### `config/default.js`

暗号化に使用する鍵を記述している

`bcryptSalt`は暗号化する前に付加することで解読を困難にするためのもの

`secret`は暗号化キー

