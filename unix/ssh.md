# SSHとは

セキュアシェルの略

安全な接続でシェルを遠隔操作できる

サーバなどCUIの操作を必要とするマシンを手元のPCから操作する際によく使う


# 設定方法概要

接続方法にパスワード方式と公開鍵暗号方式があるが、より安全な公開鍵暗号方式を使用する

パスワード方式でのログインはできないようにサーバの設定を変える

より安全にするためには接続に使用するポートを変更する、デフォルトの２２番ポートはウェルノウンポートのため狙われやすい

公開鍵と秘密鍵を生成し、公開鍵をサーバに秘密鍵を操作するクライアントに配置する

クライアントでコマンドのエイリアスの設定をする

# コマンド

`ssh [接続先] -i [鍵ファイルパス]`

基本的に鍵ファイルは`~/.ssh/`内に置こうと思う

# 設定手順

### サーバ側の操作

レンタルサーバなど、サーバが直接操作できない場合は、まずはパスワードでのSSHで操作する

IPアドレスを調べる`ip a`

vimで`/etc/ssh/sshd_config`を開いて編集する

28行目あたり`PemitRootLogin no`に変更する、これでパスワードでのログインができなくなる

※ パスワードでサーバにSSHで接続している場合は後回しにしたほうが良い？

ポートを変更する場合はその変更もする（調べて）

SSH再起動`systemctl restart sshd`

鍵の生成`ssh-keygen -t rsa`

鍵の名前を聞かれるのでつける、パスフレーズは空白で良い、よりセキュアにするなら設定

作成した公開鍵（pubが付いてる方)を移動`sudo mv xxxx.pub ~/.ssh/authorized_keys`

パーミッション（権限）を変更`chmod 600 ~/.ssh/authorized_keys`

USBメモリやファイル転送などで秘密鍵（pubがついていない方）をクライアントに転送する

### クライアント側の操作（Mac）

秘密鍵を移動`sudo mv xxxx ~/.ssh/xxxx`

パーミッション（権限）を変更`chmod 600 ~/.ssh/xxxx`

SSH接続を行う`ssh user@192.168.1.xx -i xxxx -p portNumber`

- userはサーバでログインするユーザ
- xxxxは設置した秘密鍵のパス
- ポートを変更していない場合は-p以降不要

※ 接続できない場合は`ping 192.168.1.xx`で物理的につながっているか調べてみる

SSHコマンドを簡略化するためのconfig作成、すでにある場合は追記 `~/.ssh/config`

```
Host 接続名(自由)
    HostName ホスト名（IPアドレス）
    User ユーザー名
    IdentityFile ~/.ssh/秘密鍵のファイル名
    Port ポート番号
    TCPKeepAlive yes
    IdentitiesOnly yes
```

権限を追加 `chmod 600 config`

`ssh 接続名`で接続できることを確認する
