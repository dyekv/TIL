## AWS Identity and Access Management (IAM)

アクセス許可の仕組み

### AWS IAMにおける、単語の定義

-  ユーザー
  - 永続的な名前がつけられた操作者
  - 人間の場合もあれば機械の場合もある
  - 認証情報は永続的であり、その名前のユーザとの対応関係はローテーションが強制されるまで変わらない
  - ユーザネームとパスワード及びアクセスキーとシークレットキーの認証方法がある
- グループ
   - ユーザの集合
- ロール
  - ロールはアクセス許可ではなく、認証方法
  - ロールは操作者で、人間の場合もあれば機械の場合もある
  - 一時的な認証情報
- ポリシードキュメント
  - AWSはAPIの集合体である
  - APIを実行するために、最初に認証して認可する必要がある
  - ユーザーとロールは認証の仕組みで、実際のアクセス許可はポリシードキュメントで行われる
    - ユーザーに直接アタッチされる場合と、グループにアタッチされる場合、ロールに直接アタッチされる場合がある
  - JSON形式のドキュメント
    - 特定のAPIまたは、APIのワイルドカードグループが列挙される
    - ホワイトリスト形式
    - どのリソースを対象に許可するかを示す
    - ホームネットワーク内のみ許可や、VPNの場合の許可、時間帯によって許可などの条件を設定できる
    
### IAMの流れ

例：S3パケットにオブジェクトを配置する

- 操作者がS3バケットにオブジェクトを配置するAPIコールをする
- 認証情報セットを提示する（アクセスキーとシークレットキー）
- IMAエンジンがその認証情報を調べる
- アクティブなユーザーやロールであることが認証される
- そのユーザーにアタッチされている"全て"のポリシードキュメントが参照される
- S3へのオブジェクトのPUTが認可されている場合、APIが実行される
- もし、１箇所でも明示的に拒否されていた場合は、APIの実行は拒否される（明示的な拒否が優先される）

このように、認証されてもポリシーで認可されないとAPIの実行はできない

もし、ユーザ（永続的）のログイン情報が流出してしまっても、すぐにポリシーで拒否すればAPIの実行を防ぐことができる

サーバを削除する代わりに金銭を要求する身代金系の脅迫への対応

さらにでAPIアクションが失敗しても`CloudTrail`に記録される

