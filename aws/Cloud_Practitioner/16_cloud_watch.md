## Amazon Cloud Watch

AWSのリソースとAWSで実行されているアプリケーションをリアルタイムでモニタリングする

### 概要

メモリ使用率、ディスクI/Oを関しし、設定値を超えるとアラートを出したりログを取ったりできる

CPU使用率監視・ビューカウントなどの基本的なメトリクス＋アプリケーション特有のメトリクスが利用できる

メトリクスはAWSコンソールで確認することができる

また、アラーム機能を使って、１つ以上のアクションと結びつけることができる

![cloudwatch](https://user-images.githubusercontent.com/56820273/107140967-251be600-6969-11eb-8457-db12133f6426.png)

### コンポーネント

- ### メトリクス

システムのパフォーマンスに関するデータを取得できる

いくつかのサービスでは無料のメトリクスを提供している（EC2/EBS/RDSなど）

それ以外のアプリケーションも有料で追加することができる

- ### アラーム

１つのメトリクスを監視し、１つ以上のアクションを実行することができる

アクションは様々（EC2/Auto Scaling/SNSトピックへの通知）

持続的な状態変更に対してのみアクションを呼び出す

例：

  - EC2のCPU使用率60%以上が５分続いたとき
  - RDSの同時接続数10以上が１分続いたとき
  - ELBの正常なホスト数５以下１０分続いたとき・・など

- ### イベント

AWSリソースの変更をほぼリアルタイムで検知

事前に設定したルールに一致したイベントをターゲットとなる関数やストリームにルーティングする

オペレーションの変更を認識し、必要であれば修正アクションを実行する

cronを使用して、特定の時間にトリガーするアクションを作成することもできる

例：

  - 意図しないIAMアクセスを検出して自動的に取り消す


- ### ログ

既存のログファイルを使用してシステムとアプリケーションをモニタリングする（特定のフレーズ、値、パターンを探す）

関連するログデータをCloudWatch Logsから取得する

OSにインストールされたエージェントに基づいて実行される

AWSで使用できる全てのOSに互換性のあるエージェントを提供している

EC2のログをリアルタイムでモニタリングし、CloudTrail（全てのAPIアクション）のログもモニタリングする

AWS上の全ての操作はAPIを使用しているため、実質、誰が何をしたか全てを記録することができる

また、ログデータを後で見るためにアーカイブできる

- ### ダッシュボード

複数のメトリクスを１画面で監視することができる


### ユースケース

AWSリソースに変更があったときの処理を行う

- EC2が実行中になったら`Amazon Lambda`で自動的にDNSエントリを更新する

- スケジュールに従って`Amazon EBS`ボリュームのスナップショットを作成する

- CPU使用率が60%を超える状態が５分続いたときに`Auto Scaring`でスケールアウトする



